<div class="dashboard-container">
  <%= render partial: 'shared/sidebar_menu' %>
  <div class="content">
    <%= render partial: 'shared/header' %>
    
    <div class="reports-container">
      <div class="report-header">
        <h1 class="reports-title"><i class="fa fa-check-square-o"></i> Attendance Report</h1>
        <%= link_to "â† Back to Reports", reports_path, class: "back-link" %>
      </div>

      <!-- Filters -->
      <div class="filter-section">
        <%= form_tag attendance_reports_path, method: :get, class: "date-filter-form" do %>
          <div class="filter-row">
            <div class="filter-group">
              <label for="date">Filter by Date:</label>
              <%= date_field_tag :date, params[:date], class: "date-input" %>
            </div>
            <div class="filter-group">
              <label for="qabeela">Filter by Qabeela:</label>
              <%= select_tag :qabeela, 
                  options_for_select([['All Qabeela', '']] + @qabeela_options.map { |q| [q, q] }, params[:qabeela]),
                  { class: "qabeela-select" } %>
            </div>
            <div class="filter-group">
              <label for="type">Filter by Type:</label>
              <%= select_tag :type, 
                  options_for_select([['All Types', ''], ['Member', 'member'], ['Guest', 'guest']], params[:type]),
                  { class: "type-select" } %>
            </div>
            <div class="filter-actions">
              <%= submit_tag "Filter", class: "filter-btn" %>
              <% if params[:date].present? || params[:qabeela].present? || params[:type].present? %>
                <%= link_to "Clear", attendance_reports_path, class: "clear-btn" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Summary Stats -->
      <div class="stats-grid">
        <div class="stat-card stat-success">
          <div class="stat-info">
            <span class="stat-value"><%= @total_attendance %></span>
            <span class="stat-label">Total Attendance</span>
          </div>
        </div>
        <div class="stat-card stat-blue">
          <div class="stat-info">
            <span class="stat-value"><%= @male_attendance %></span>
            <span class="stat-label">Male</span>
          </div>
        </div>
        <div class="stat-card stat-pink">
          <div class="stat-info">
            <span class="stat-value"><%= @female_attendance %></span>
            <span class="stat-label">Female</span>
          </div>
        </div>
        <div class="stat-card stat-indigo">
          <div class="stat-info">
            <span class="stat-value"><%= @member_attendance %></span>
            <span class="stat-label">Members</span>
          </div>
        </div>
        <div class="stat-card stat-purple">
          <div class="stat-info">
            <span class="stat-value"><%= @guest_attendance %></span>
            <span class="stat-label">Guests</span>
          </div>
        </div>
      </div>

      <!-- Attendance Table -->
      <div class="report-table-container">
        <div class="table-header-actions">
          <%= link_to attendance_export_reports_path(date: params[:date], qabeela: params[:qabeela], type: params[:type]), 
              class: "download-btn", 
              title: "Download as Excel" do %>
            <i class="fa fa-download"></i> Download Excel
          <% end %>
        </div>
        <table class="report-table">
          <thead>
            <tr>
              <th>Token #</th>
              <th>Name</th>
              <th>CNIC</th>
              <th>KID</th>
              <th>Execution No</th>
              <th>Gender</th>
              <th>Type</th>
              <th>Qabeela</th>
              <th>Printed At</th>
            </tr>
          </thead>
          <tbody>
            <% @voters.each do |voter| %>
              <tr class="<%= voter.guest_entry ? 'guest-row' : '' %>">
                <td><%= voter.token_number %></td>
                <td>
                  <%= voter.name %>
                  <% if voter.guest_entry %>
                    <span class="badge badge-guest">Guest</span>
                  <% end %>
                </td>
                <td><%= voter.cnic %></td>
                <td><%= voter.kid.to_i %></td>
                <td><%= voter.execution_no.presence || "-" %></td>
                <td><%= voter.cnic.to_i.even? ? "Female" : "Male" %></td>
                <td>
                  <% if voter.guest_entry %>
                    <span class="badge badge-guest">Guest</span>
                  <% else %>
                    <span class="badge badge-member">Member</span>
                  <% end %>
                </td>
                <td><%= voter.qabeela %></td>
                <td><%= voter.updated_at.strftime("%d-%b-%Y %I:%M %p") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
        
        <% if @voters.empty? %>
          <div class="no-data">No attendance records found for the selected criteria.</div>
        <% end %>
      </div>
    </div>
  </div>
</div>

